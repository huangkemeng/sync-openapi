# Sync OpenAPI

ä¸€ä¸ªå¿«é€ŸåŒæ­¥åç«¯å®šä¹‰çš„ OpenAPI å¥‘çº¦åˆ°å‰ç«¯çš„å·¥å…·ï¼Œè‡ªåŠ¨ç”Ÿæˆ TypeScript æ¥å£é…ç½®å’Œ Axios è¯·æ±‚å‡½æ•°ã€‚

[![npm version](https://img.shields.io/npm/v/sync-openapi.svg)](https://www.npmjs.com/package/sync-openapi)
[![license](https://img.shields.io/npm/l/sync-openapi.svg)](https://github.com/huangkemeng/sync-openapi/blob/main/LICENSE)

## ç‰¹æ€§

- ğŸš€ **å¿«é€ŸåŒæ­¥**: ä» OpenAPI/Swagger è§„èŒƒè‡ªåŠ¨ç”Ÿæˆå‰ç«¯ API é…ç½®
- ğŸ“ **TypeScript æ”¯æŒ**: ç”Ÿæˆå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- ğŸ”§ **Axios é›†æˆ**: è‡ªåŠ¨ç”ŸæˆåŸºäº Axios çš„ HTTP è¯·æ±‚å‡½æ•°
- ğŸ“ **æ¨¡å—åŒ–ç»„ç»‡**: æŒ‰ API æ ‡ç­¾åˆ†ç»„ï¼Œç»“æ„æ¸…æ™°
- ğŸ¯ **æ™ºèƒ½å‘½å**: è‡ªåŠ¨è½¬æ¢è·¯å¾„ä¸ºé©¼å³°å‘½åæ³•
- ğŸ“¦ **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒ JSONã€è¡¨å•æ•°æ®ã€æ–‡ä»¶ä¸Šä¼ ç­‰
- âš¡ **é›¶é…ç½®**: å¼€ç®±å³ç”¨ï¼Œæ— éœ€å¤æ‚é…ç½®

## å®‰è£…

### å…¨å±€å®‰è£…

```bash
npm install sync-openapi -g
```

### é¡¹ç›®ä¾èµ–å®‰è£…

```bash
npm install sync-openapi --save-dev
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
sync-api --url https://api.example.com/swagger.json -o ./src/apis
```

### å¼ºåˆ¶æ›´æ–°é…ç½®

```bash
sync-api --url https://api.example.com/swagger.json -f -o ./src/apis
```

### ç”Ÿæˆå…¨å±€ç±»å‹å®šä¹‰

```bash
sync-api --url https://api.example.com/swagger.json -t -o ./src/apis
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ | å¿…å¡« |
|------|------|------|------|
| `--url` | OpenAPI/Swagger JSON æ–‡ä»¶çš„ URL | `--url https://api.example.com/swagger.json` | æ˜¯ |
| `-o` | è¾“å‡ºç›®å½• | `-o ./src/apis` | å¦ï¼Œé»˜è®¤ `./src/apis` |
| `-f` | å¼ºåˆ¶ä» URL ä¸‹è½½å¹¶è¦†ç›–æœ¬åœ°é…ç½® | `-f` | å¦ |
| `-t` | ç”Ÿæˆå…¨å±€ç±»å‹å®šä¹‰æ–‡ä»¶ | `-t` | å¦ |

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬åŒæ­¥

```bash
# ä»è¿œç¨‹ OpenAPI é…ç½®ç”Ÿæˆ API
sync-api --url https://petstore.swagger.io/v2/swagger.json -o ./src/api
```

### 2. å¼ºåˆ¶æ›´æ–°

```bash
# å¼ºåˆ¶ä¸‹è½½æœ€æ–°é…ç½®å¹¶è¦†ç›–æœ¬åœ°
sync-api --url https://api.example.com/swagger.json -f -o ./src/apis
```

### 3. å®Œæ•´åŠŸèƒ½

```bash
# ç”Ÿæˆ API é…ç½®å’Œå…¨å±€ç±»å‹å®šä¹‰
sync-api --url https://api.example.com/swagger.json -f -t -o ./src/apis
```

## ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

æ‰§è¡Œå‘½ä»¤åï¼Œå·¥å…·ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
src/apis/
â”œâ”€â”€ ApiAxiosInstance.ts      # Axios å®ä¾‹é…ç½®
â”œâ”€â”€ ApiClient.ts             # å…¨å±€ API å®¢æˆ·ç«¯
â”œâ”€â”€ ApiTypes.ts              # å…¨å±€ç±»å‹å®šä¹‰ï¼ˆä½¿ç”¨ -t å‚æ•°æ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ Tag1/                    # æŒ‰æ ‡ç­¾åˆ†ç»„çš„ API
â”‚   â”œâ”€â”€ GetUserById/
â”‚   â”‚   â””â”€â”€ index.http.ts    # å•ä¸ª API çš„è¯·æ±‚å‡½æ•°å’Œç±»å‹
â”‚   â””â”€â”€ CreateUser/
â”‚       â””â”€â”€ index.http.ts
â””â”€â”€ Tag2/
    â””â”€â”€ ...
```

## ç”Ÿæˆçš„ä»£ç ç¤ºä¾‹

### API è¯·æ±‚å‡½æ•°

```typescript
// src/apis/User/getUserById/index.http.ts
import type { AxiosRequestConfig, AxiosResponse } from "axios";
import axios from "../../ApiAxiosInstance";
import qs from "qs";

/**
 * æ ¹æ®IDè·å–ç”¨æˆ·ä¿¡æ¯
 */
export default function getUserById(
  queryParam: GetUserByIdRequest,
  signal?: AbortSignal,
  config?: AxiosRequestConfig
): Promise<AxiosResponse<User>> {
  return axios.get(`/users/${queryParam.id}`, {
    ...config,
    signal,
    params: queryParam,
    paramsSerializer: function (params) {
      return qs.stringify(params, { indices: false });
    }
  });
}

export interface GetUserByIdRequest {
  id: number;
}

export interface User {
  id: number;
  name: string;
  email: string;
}
```

### å…¨å±€ API å®¢æˆ·ç«¯

```typescript
// src/apis/ApiClient.ts
import getUserById from "./User/getUserById/index.http"
import createUser from "./User/createUser/index.http"

const ApiClient = {
    User: {
        getUserById: getUserById,
        createUser: createUser,
    },
}

export default ApiClient
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
import ApiClient from './src/apis/ApiClient'

// è°ƒç”¨ API
const response = await ApiClient.User.getUserById({ id: 123 })

// å¸¦å–æ¶ˆåŠŸèƒ½çš„è°ƒç”¨
const controller = new AbortController()
const response = await ApiClient.User.getUserById(
  { id: 123 },
  controller.signal
)
```

## æ”¯æŒçš„åŠŸèƒ½

### HTTP æ–¹æ³•
- âœ… GET
- âœ… POST  
- âœ… PUT
- âœ… DELETE
- âœ… PATCH

### å‚æ•°ç±»å‹
- âœ… è·¯å¾„å‚æ•°
- âœ… æŸ¥è¯¢å‚æ•°
- âœ… è¯·æ±‚ä½“ï¼ˆJSONï¼‰
- âœ… è¡¨å•æ•°æ®ï¼ˆmultipart/form-dataï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ 

### æ•°æ®ç±»å‹
- âœ… åŸºæœ¬ç±»å‹ï¼ˆstring, number, booleanï¼‰
- âœ… å¯¹è±¡ç±»å‹
- âœ… æ•°ç»„ç±»å‹
- âœ… æšä¸¾ç±»å‹
- âœ… å¼•ç”¨ç±»å‹ï¼ˆ$refï¼‰
- âœ… å¯ä¸ºç©ºç±»å‹

## é…ç½®è¯´æ˜

### Axios å®ä¾‹é…ç½®

ç”Ÿæˆçš„ `ApiAxiosInstance.ts` æ–‡ä»¶åŒ…å«åŸºç¡€çš„ Axios é…ç½®ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰ï¼š

```typescript
import axios from 'axios';

const apiAxiosInstance = axios.create({
  baseURL: process.env.API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
apiAxiosInstance.interceptors.request.use(
  config => {
    // æ·»åŠ è®¤è¯ token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  error => {
    return Promise.reject(error);
  }
);

export default apiAxiosInstance;
```

## æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬æ§åˆ¶
å»ºè®®å°†ç”Ÿæˆçš„ API æ–‡ä»¶æ·»åŠ åˆ° `.gitignore`ï¼Œåœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆï¼š

```gitignore
src/apis/
```

### 2. è‡ªå®šä¹‰é…ç½®
åœ¨ç”Ÿæˆåï¼Œå¯ä»¥ä¿®æ”¹ `ApiAxiosInstance.ts` æ¥æ·»åŠ è®¤è¯ã€é”™è¯¯å¤„ç†ç­‰é€»è¾‘ã€‚

### 3. ç±»å‹å®‰å…¨
ä½¿ç”¨ `-t` å‚æ•°ç”Ÿæˆå…¨å±€ç±»å‹å®šä¹‰ï¼Œè·å¾—æ›´å¥½çš„ TypeScript æ”¯æŒã€‚

### 4. è‡ªåŠ¨æ›´æ–°
åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬ï¼Œæ–¹ä¾¿å›¢é˜Ÿä½¿ç”¨ï¼š

```json
{
  "scripts": {
    "sync-api": "sync-api --url https://api.example.com/swagger.json -f -o ./src/apis",
    "dev": "npm run sync-api && npm run start"
  }
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ‰§è¡Œå‘½ä»¤æ—¶æŠ¥é”™ "è¯·å…ˆä¼ å…¥swaggeré…ç½®çš„urlåœ°å€ï¼"**
A: ç¡®ä¿æ­£ç¡®ä½¿ç”¨äº† `--url` å‚æ•°ï¼Œå¹¶ä¸” URL åœ°å€æœ‰æ•ˆã€‚

**Q: ç”Ÿæˆçš„ç±»å‹å®šä¹‰ä¸å®Œæ•´**
A: ç¡®ä¿ OpenAPI è§„èŒƒæ˜¯ 3.x ç‰ˆæœ¬ï¼Œå¹¶ä½¿ç”¨ `-t` å‚æ•°ç”Ÿæˆå…¨å±€ç±»å‹ã€‚

**Q: ç½‘ç»œè¯·æ±‚å¤±è´¥**
A: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ URL å¯è®¿é—®æ€§ï¼Œç¡®ä¿æ²¡æœ‰é˜²ç«å¢™æˆ–ä»£ç†é™åˆ¶ã€‚

**Q: ç”Ÿæˆçš„ä»£ç æœ‰ TypeScript é”™è¯¯**
A: ç”Ÿæˆçš„ä»£ç åŒ…å« `// @ts-nocheck` æŒ‡ä»¤ï¼Œå¦‚éœ€ä¸¥æ ¼ç±»å‹æ£€æŸ¥å¯ç§»é™¤è¯¥æŒ‡ä»¤ã€‚

## å¼€å‘

### æ„å»ºé¡¹ç›®

```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»º TypeScript
npm run build
```

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
npm test
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ ISC è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ä½œè€…

**huangkemeng**

- GitHub: [@huangkemeng](https://github.com/huangkemeng)

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [Axios](https://github.com/axios/axios) - Promise based HTTP client
- [OpenAPI Specification](https://github.com/OAI/OpenAPI-Specification) - The OpenAPI Specification
- [Chalk](https://github.com/chalk/chalk) - Terminal string styling

---

**æ³¨æ„**: æœ¬å·¥å…·ä¸“ä¸º OpenAPI 3.x è§„èŒƒè®¾è®¡ï¼Œä½¿ç”¨å…¶ä»–ç‰ˆæœ¬å¯èƒ½æ— æ³•ä¿è¯ç”Ÿæˆçš„ API é…ç½®å®Œå…¨æ­£ç¡®ã€‚
